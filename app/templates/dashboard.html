{% extends "base.html" %}

{% block title %}仪表板{% endblock %}

{% block extra_css %}
<style>
    /* 自定义仪表板样式 */
    .dashboard-section {
        background-color: #f8f9fa;
        border-radius: 10px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .file-list {
        max-height: 300px;
        overflow-y: auto;
    }
</style>
{% endblock %}

{% block content %}
<h2 class="mb-4">欢迎, {{ current_user.username }}!</h2>

<div class="row">
    <div class="col-md-6">
        <div class="dashboard-section">
            <h3><i class="fas fa-upload"></i> 上传文件</h3>
            <form action="{{ url_for('main.upload_file') }}" method="POST" enctype="multipart/form-data">
                <div class="mb-3">
                    <input type="file" class="form-control" name="file" required>
                </div>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-cloud-upload-alt"></i> 上传
                </button>
            </form>
        </div>
    </div>

    <div class="col-md-6">
        <div class="dashboard-section">
            <h3><i class="fas fa-file-alt"></i> 您的文件</h3>
            <div class="file-list">
                <ul class="list-group">
                    {% for file in files %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <span><i class="fas fa-file"></i> {{ file.filename }}</span>
                        <a href="{{ url_for('main.delete_file', file_id=file.id) }}" class="btn btn-danger btn-sm">
                            <i class="fas fa-trash-alt"></i> 删除
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-12">
        <div class="dashboard-section">
            <h3><i class="fas fa-robot"></i> AI 查询</h3>
            <form id="query-form">
                <div class="mb-3">
                    <textarea class="form-control" id="query" rows="3" placeholder="输入您的问题..." required></textarea>
                </div>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-search"></i> 提交查询
                </button>
            </form>
            <div id="ai-response" class="mt-3"></div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // AI查询功能的JavaScript代码
    $(document).ready(function() {
        $('#query-form').on('submit', function(e) {
            e.preventDefault();
            var query = $('#query').val();
            $.ajax({
                url: '/ai_query',
                method: 'POST',
                data: { query: query },
                success: function(response) {
                    $('#ai-response').html('<div class="alert alert-info">' + response.answer + '</div>');
                },
                error: function() {
                    $('#ai-response').html('<div class="alert alert-danger">查询出错,请稍后再试。</div>');
                }
            });
        });
    });
</script>
{% endblock %}
